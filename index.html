<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>人力工时换算器｜Men/Day · Men/Week · Men/Month</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            oat: '#EDE3E1',
            mouse: '#C7BEBE',
            rock: '#655C5C',
            ink: '#1f2937'
          },
          boxShadow: {
            soft: '0 10px 20px rgba(0,0,0,0.06)',
          },
          borderRadius: {
            '2xl': '1.25rem'
          }
        }
      }
    }
  </script>
  <style>
    ::selection { background: #C7BEBE; color:#111827; }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type="number"] { -moz-appearance: textfield; }
  </style>
</head>
<body class="min-h-screen bg-oat/40 text-ink">
  <div class="max-w-6xl mx-auto px-4 py-8">
    <header class="flex items-center justify-between mb-6">
      <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight">
        人力工时换算器 <span class="text-rock">Men/Day · Men/Week · Men/Month</span>
      </h1>
      <div class="flex gap-2">
        <button id="btnExample" class="px-3 py-2 rounded-xl bg-ink text-white hover:opacity-90 transition shadow-soft">填入示例</button>
        <button id="btnReset" class="px-3 py-2 rounded-xl bg-white border hover:bg-oat transition shadow-soft">清空</button>
      </div>
    </header>

    <section class="grid md:grid-cols-3 gap-6">
      <!-- Left: Inputs -->
      <div class="md:col-span-2 space-y-4">
        <div class="bg-white rounded-2xl p-4 shadow-soft border">
          <h2 class="font-semibold mb-3">人员与工时（小时）</h2>
          <p class="text-sm text-gray-500 mb-3">每行代表 1 位成员，可选填姓名，必填该成员的工作时长（小时）。</p>

          <div id="rows" class="space-y-2"></div>

          <div class="mt-3 flex justify-between items-center">
            <button id="btnAdd" class="px-3 py-2 rounded-xl bg-ink text-white hover:opacity-90 transition">+ 添加成员</button>
            <div class="text-sm text-gray-500">小技巧：按 <kbd>Tab</kbd> 可快速跳到下一格，输入会自动实时换算。</div>
          </div>
        </div>

        <div class="bg-white rounded-2xl p-4 shadow-soft border">
          <h2 class="font-semibold mb-3">换算设置</h2>
          <div class="grid sm:grid-cols-3 gap-4">
            <label class="block">
              <span class="text-sm text-gray-600">每天工时（小时/Day）</span>
              <input id="hoursPerDay" type="number" step="0.01" min="0.1" class="mt-1 w-full px-3 py-2 rounded-xl border focus:outline-none focus:ring focus:ring-mouse" value="8">
            </label>
            <label class="block">
              <span class="text-sm text-gray-600">每周工作天数（Days/Week）</span>
              <input id="daysPerWeek" type="number" step="0.1" min="1" class="mt-1 w-full px-3 py-2 rounded-xl border focus:outline-none focus:ring focus:ring-mouse" value="5">
            </label>
            <div class="block">
              <span class="text-sm text-gray-600">人月换算基准</span>
              <div class="mt-1 flex items-center gap-3">
                <label class="inline-flex items-center gap-2">
                  <input type="radio" name="monthMode" value="weeks" checked>
                  <span>按周（4.33 周/月）</span>
                </label>
                <label class="inline-flex items-center gap-2">
                  <input type="radio" name="monthMode" value="days">
                  <span>按天</span>
                </label>
              </div>
              <div id="monthExtra" class="grid grid-cols-2 gap-3 mt-2">
                <label class="block" data-mode="weeks">
                  <span class="text-sm text-gray-600">每月折算（Weeks/Month）</span>
                  <input id="weeksPerMonth" type="number" step="0.01" min="1" class="mt-1 w-full px-3 py-2 rounded-xl border focus:outline-none focus:ring focus:ring-mouse" value="4.33">
                </label>
                <label class="block hidden" data-mode="days">
                  <span class="text-sm text-gray-600">每月工作天数（Days/Month）</span>
                  <input id="daysPerMonth" type="number" step="0.1" min="1" class="mt-1 w-full px-3 py-2 rounded-xl border focus:outline-none focus:ring focus:ring-mouse" value="20">
                </label>
              </div>
            </div>
          </div>
          <p class="text-xs text-gray-500 mt-2">
            说明：
            <span class="inline-block">人天 = 总工时 ÷ 每天工时；</span>
            <span class="inline-block">人周 = 总工时 ÷（每天工时 × 每周工作天数）；</span>
            <span class="inline-block">人月 = 人周 ÷ 每月折算周数 <em>或</em> 总工时 ÷（每天工时 × 每月工作天数）。</span>
          </p>
        </div>
      </div>

      <!-- Right: Results -->
      <div class="space-y-4">
        <div class="bg-white rounded-2xl p-4 shadow-soft border">
          <h2 class="font-semibold mb-3">汇总</h2>
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div class="p-3 rounded-xl bg-oat/60 border">
              <div class="text-gray-500">总人数</div>
              <div id="totalPeople" class="text-2xl font-bold">0</div>
            </div>
            <div class="p-3 rounded-xl bg-oat/60 border">
              <div class="text-gray-500">总工时（小时）</div>
              <div id="totalHours" class="text-2xl font-bold">0</div>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-2xl p-4 shadow-soft border">
          <h2 class="font-semibold mb-3">换算结果</h2>
          <div class="space-y-3">
            <div class="flex items-center justify-between p-3 rounded-xl bg-oat/60 border">
              <div>
                <div class="text-gray-500 text-sm">Men/Day（人天）</div>
                <div id="outDays" class="text-2xl font-extrabold">0</div>
              </div>
              <button data-copy="#outDays" class="copy px-3 py-2 rounded-xl bg-ink text-white hover:opacity-90 transition">复制</button>
            </div>
            <div class="flex items-center justify-between p-3 rounded-xl bg-oat/60 border">
              <div>
                <div class="text-gray-500 text-sm">Men/Week（人周）</div>
                <div id="outWeeks" class="text-2xl font-extrabold">0</div>
              </div>
              <button data-copy="#outWeeks" class="copy px-3 py-2 rounded-xl bg-ink text-white hover:opacity-90 transition">复制</button>
            </div>
            <div class="flex items-center justify-between p-3 rounded-xl bg-oat/60 border">
              <div>
                <div class="text-gray-500 text-sm">Men/Month（人月）</div>
                <div id="outMonths" class="text-2xl font-extrabold">0</div>
              </div>
              <button data-copy="#outMonths" class="copy px-3 py-2 rounded-xl bg-ink text-white hover:opacity-90 transition">复制</button>
            </div>
          </div>
          <p class="text-xs text-gray-500 mt-3">数值保留 3 位小数，并随输入实时更新。</p>
        </div>

        <div class="bg-white rounded-2xl p-4 shadow-soft border">
          <h2 class="font-semibold mb-3">导入 / 导出</h2>
          <div class="flex gap-3">
            <button id="btnExport" class="px-3 py-2 rounded-xl bg-white border hover:bg-oat transition">导出 JSON</button>
            <label class="px-3 py-2 rounded-xl bg-white border hover:bg-oat transition cursor-pointer">
              导入 JSON
              <input id="fileImport" type="file" accept="application/json" class="hidden">
            </label>
          </div>
          <p class="text-xs text-gray-500 mt-2">包含人员列表与换算设置。也会自动保存到本地浏览器。</p>
        </div>
      </div>
    </section>

    <footer class="text-center text-xs text-gray-500 mt-8 pt-6 border-t">
      Made with ❤️ for efficient planning · © 2025
    </footer>
  </div>

  <template id="rowTmpl">
    <div class="grid grid-cols-12 gap-3 items-center">
      <input type="text" placeholder="姓名（可选）" class="col-span-4 px-3 py-2 rounded-xl border focus:outline-none focus:ring focus:ring-mouse name">
      <div class="col-span-6 flex items-center gap-2">
        <input type="number" step="0.01" min="0" class="w-full px-3 py-2 rounded-xl border focus:outline-none focus:ring focus:ring-mouse hours" placeholder="工时（小时）">
        <span class="text-gray-500 text-sm">h</span>
      </div>
      <button class="col-span-2 px-3 py-2 rounded-xl bg-white border hover:bg-oat transition remove">删除</button>
    </div>
  </template>

  <script>
    const $ = (sel, el=document)=>el.querySelector(sel);
    const $$ = (sel, el=document)=>Array.from(el.querySelectorAll(sel));

    const els = {
      rows: $('#rows'),
      tmpl: $('#rowTmpl'),
      add: $('#btnAdd'),
      reset: $('#btnReset'),
      example: $('#btnExample'),
      totalPeople: $('#totalPeople'),
      totalHours: $('#totalHours'),
      outDays: $('#outDays'),
      outWeeks: $('#outWeeks'),
      outMonths: $('#outMonths'),
      hoursPerDay: $('#hoursPerDay'),
      daysPerWeek: $('#daysPerWeek'),
      weeksPerMonth: $('#weeksPerMonth'),
      daysPerMonth: $('#daysPerMonth'),
      monthModeRadios: $$('input[name="monthMode"]'),
      monthExtra: $('#monthExtra'),
      copyBtns: $$('.copy'),
      exportBtn: $('#btnExport'),
      fileImport: $('#fileImport'),
    };

    function addRow({name='', hours=''}={}) {
      const node = els.tmpl.content.firstElementChild.cloneNode(true);
      $('.name', node).value = name;
      $('.hours', node).value = hours;
      $('.hours', node).addEventListener('input', compute);
      $('.remove', node).addEventListener('click', ()=>{ node.remove(); compute(); saveLocal(); });
      els.rows.appendChild(node);
      compute();
    }

    function getSettings() {
      const hoursPerDay = Math.max(0.0001, parseFloat(els.hoursPerDay.value) || 0);
      const daysPerWeek = Math.max(0.0001, parseFloat(els.daysPerWeek.value) || 0);
      const mode = els.monthModeRadios.find(r => r.checked)?.value || 'weeks';
      const weeksPerMonth = Math.max(0.0001, parseFloat(els.weeksPerMonth.value) || 0);
      const daysPerMonth = Math.max(0.0001, parseFloat(els.daysPerMonth.value) || 0);
      return { hoursPerDay, daysPerWeek, mode, weeksPerMonth, daysPerMonth };
    }

    function compute() {
      const rows = $$('.hours', els.rows);
      const hours = rows.map(i => parseFloat(i.value) || 0);
      const totalHours = hours.reduce((a,b)=>a+b,0);
      els.totalPeople.textContent = rows.length.toString();
      els.totalHours.textContent = fmt(totalHours);

      const { hoursPerDay, daysPerWeek, mode, weeksPerMonth, daysPerMonth } = getSettings();

      const menDay = totalHours / hoursPerDay;
      const menWeek = totalHours / (hoursPerDay * daysPerWeek);
      const menMonth = (mode === 'weeks')
        ? totalHours / (hoursPerDay * daysPerWeek * weeksPerMonth)
        : totalHours / (hoursPerDay * daysPerMonth);

      els.outDays.textContent = fmt(menDay);
      els.outWeeks.textContent = fmt(menWeek);
      els.outMonths.textContent = fmt(menMonth);

      saveLocal();
    }

    function fmt(n) {
      return (Math.round((n + Number.EPSILON) * 1000) / 1000).toFixed(3);
    }

    function saveLocal() {
      const data = {
        people: $$('.grid > .name', els.rows.parentElement).map(()=>{}), // placeholder to keep structure
      };
      const people = $$('.grid', els.rows).map(row => ({
        name: $('.name', row).value || '',
        hours: parseFloat($('.hours', row).value || '0')
      }));
      const settings = getSettings();
      const payload = { people, settings };
      try { localStorage.setItem('menpower-data', JSON.stringify(payload)); } catch(e) {}
    }

    function loadLocal() {
      try {
        const raw = localStorage.getItem('menpower-data');
        if (!raw) return false;
        const { people=[], settings } = JSON.parse(raw);
        els.rows.innerHTML = '';
        people.forEach(p => addRow(p));
        if (settings) {
          els.hoursPerDay.value = settings.hoursPerDay ?? 8;
          els.daysPerWeek.value = settings.daysPerWeek ?? 5;
          els.weeksPerMonth.value = settings.weeksPerMonth ?? 4.33;
          els.daysPerMonth.value = settings.daysPerMonth ?? 20;
          const mode = settings.mode || 'weeks';
          els.monthModeRadios.forEach(r => r.checked = (r.value===mode));
          syncMonthMode();
        }
        compute();
        return true;
      } catch(e) { return false; }
    }

    function syncMonthMode() {
      const mode = els.monthModeRadios.find(r => r.checked)?.value || 'weeks';
      $$('[data-mode]', els.monthExtra).forEach(x => {
        const m = x.getAttribute('data-mode');
        if (m === mode) x.classList.remove('hidden');
        else x.classList.add('hidden');
      });
      compute();
    }

    function exportJSON() {
      const people = $$('.grid', els.rows).map(row => ({
        name: $('.name', row).value || '',
        hours: parseFloat($('.hours', row).value || '0')
      }));
      const payload = { people, settings: getSettings(), exportedAt: new Date().toISOString() };
      const blob = new Blob([JSON.stringify(payload, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'menpower-data.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function importJSON(file) {
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const data = JSON.parse(reader.result);
          els.rows.innerHTML = '';
          (data.people || []).forEach(p => addRow(p));
          if (data.settings) {
            els.hoursPerDay.value = data.settings.hoursPerDay ?? 8;
            els.daysPerWeek.value = data.settings.daysPerWeek ?? 5;
            els.weeksPerMonth.value = data.settings.weeksPerMonth ?? 4.33;
            els.daysPerMonth.value = data.settings.daysPerMonth ?? 20;
            const mode = data.settings.mode || 'weeks';
            els.monthModeRadios.forEach(r => r.checked = (r.value===mode));
            syncMonthMode();
          }
          compute();
        } catch (e) {
          alert('导入失败：JSON 格式不正确。');
        }
      };
      reader.readAsText(file);
    }

    // Event bindings
    els.add.addEventListener('click', ()=> addRow());
    els.reset.addEventListener('click', ()=> {
      els.rows.innerHTML = '';
      addRow(); addRow(); addRow();
      compute();
    });
    els.example.addEventListener('click', ()=> {
      els.rows.innerHTML = '';
      addRow({name:'A', hours:5});
      addRow({name:'B', hours:8});
      addRow({name:'C', hours:8});
      compute();
    });
    [els.hoursPerDay, els.daysPerWeek, els.weeksPerMonth, els.daysPerMonth].forEach(i => i.addEventListener('input', compute));
    els.monthModeRadios.forEach(r => r.addEventListener('change', syncMonthMode));
    els.copyBtns.forEach(btn => btn.addEventListener('click', ()=>{
      const target = btn.getAttribute('data-copy');
      const text = $(target)?.textContent?.trim() || '';
      navigator.clipboard.writeText(text).then(()=>{
        btn.textContent = '已复制';
        setTimeout(()=>btn.textContent='复制', 1200);
      });
    }));
    els.exportBtn.addEventListener('click', exportJSON);
    els.fileImport.addEventListener('change', (e)=>{
      if (e.target.files && e.target.files[0]) importJSON(e.target.files[0]);
      e.target.value = '';
    });

    // Init
    if (!loadLocal()) {
      addRow(); addRow(); addRow();
      compute();
    }
  </script>
</body>
</html>
